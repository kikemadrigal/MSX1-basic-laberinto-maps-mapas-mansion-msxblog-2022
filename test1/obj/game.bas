20defusr=&h003B:a=usr(0):defusr1=&h003E:a=usr1(0):defusr2=&H90:a=usr2(0):defusr3=&h41:defusr4=&h44
30color1,15,7:screen2,0,0
40definta-z:open"grp:"as#1
50gosub9000
70'gosub5000
80gosub6000
100tm=40:tn=0:time=0
110gs=0
120strig(0)on
200ifgs=0thengoto230
210ifgs=1thengoto350
220ifgs=2thengoto300
230screen2
    235 preset (60,10):print #1,"Mansion Madrigal"
    240 preset (60,20):print #1,"MSX Murcia 2022"
    250 preset (0,50):print #1,"Debes de ingeniar como salir del laberinto antes de que se te acabe el tiempo"
    260 preset (0,90):print #1,"Utiliza las herramientas que tienes a ut disposicion, pulsa espacio para elegir una"
    270 preset (0,130):print #1,"Solo puedes utilizarlas una cez por mundo"
    280 preset (0,21*8):print #1,"Pulsa espacio para continuar"
290ifstrig(0)=-1thengs=1:goto200elsegoto290
300screen2
    305 preset (60,10):print #1,"Has ganado"
    310 preset (60,20):print #1,"MSX Murcia 2022"
    320 preset (0,50):print #1,"Desarrolador: Kike Madrigal"
330ifstrig(0)=-1thengs=1:goto200elsegoto330
350gosub5000
355'a=usr3(0)
360gosub10000
370'line(21*8,0)-(32*8,192),15,bf
380'a=usr4(0)
390gosub11000
392gosub3000
393gosub7000
394gosub3100
395gosub8300
396intervalon:oninterval=50gosub3200
398ifgs=1thenonstriggosub7100
399'spriteon:onspritegosub5700
400ifpe<=0thenrestore10100:intervaloff:gosub6700:PUTSPRITE0,(0,212),1,pp:gosub7000:gs=0:goto200
410ifta<=0thentf=0:time=0:gosub5700
420gosub1000
430gosub1760
440gosub1400
480ifmcthenms=ms+1:gosub11000:gosub3000:gosub8300:mc=0
500goto400
1000ST=STICK(0)ORSTICK(1)ORSTICK(2)
1010xp=x:yp=y
1020onstgosub1110,1120,1130,1140,1150,1160,1170
1030ifx<=0thenx=xp
1040ify<=0theny=yp
1050ify+ph>192theny=yp
1060ifx+pw>252thenx=xp
1090RETURN
1110y=y-pv:ps=p0:swapp0,p1:re=10:gosub4000:return
1120return
1130x=x+pv:ps=p2:swapp2,p3:re=10:gosub4000:return
1140return
1150y=y+pv:ps=p4:swapp4,p5:re=10:gosub4000:return
1160return
1170x=x-pv:ps=p6:swapp6,p7:re=10:gosub4000:return
1400PUTSPRITE0,(x,y),1,ps
1410ifen=0thenreturn
1430fori=1toen
1440ec(i)=ec(i)+1:ifec(i)>1thenec(i)=0
1450ifet(i)=0thenifec(i)=0thenes(i)=8elsees(i)=9
1460ifet(i)=1thenifec(i)=0thenes(i)=10elsees(i)=11
1490PUTSPRITEep(i),(ex(i),ey(i)),1,es(i)
1495nexti
1520return
1760hl=base(5)+(y/8)*32+(x/8):a=vpeek(hl)
1770ifa>3anda<16thenifos=3ando3=1thenvpokehl,0:o3=0:gosub3100:re=10:gosub3000elsex=xp:y=yp
1780'ifa=2thenx=8*16:y=8*18:beep
1790ifa=19thenre=2:gosub4000:mc=1
1800ifa=20thentf=ta:time=0:re=5:gosub4000:vpokehl,0
1810ifpc=1thenpc=0:spriteon
1900fori=1toen
1910ifet(i)=0thenex(i)=ex(i)+ev(i)
1920ifet(i)=1theney(i)=ey(i)+el(i)
1930hl=base(5)+(ey(i)/8)*32+(ex(i)/8):a=vpeek(hl)
1940ifa>3anda<16thenifet(i)=0thenev(i)=-ev(i):ex(i)=ea(i):ey(i)=ei(i)elseifet(i)=1thenel(i)=-el(i):ex(i)=ea(i):ey(i)=ei(i)
1950ea(i)=ex(i):ei(i)=ey(i)
1960ifx<ex(i)+ew(i)andx+pw>ex(i)andy<ey(i)+eh(i)andy+ph>ey(i)thenifos=2ando2=1thenre=3:gosub4000:o2=0:ed=i:gosub6600:gosub3100elsebeep:gosub5700
1970nexti
1990return
2000ifpe=0thengosub5000
2010spriteoff:pe=pe-1:gosub3000:beep:pc=1
2090return
3000line(21*8,0)-(23*8,20*8),14,bf
3010line(24*8,0)-(247,20*8),14,bf
3020preset(25*8,3*8):print#1,"World"
3030preset(26*8,5*8):print#1,mw
3040preset(25*8,7*8):print#1,"Level"
3050preset(26*8,9*8):print#1,ms
3060preset(25*8,11*8):print#1,"Live"
3070preset(26*8,13*8):print#1,pe
3080preset(24*8,21*8):print#1,fre(0)
3090return
3100ifo1thenPUTSPRITE21,((22*8)-4,5*8),6,13elsePUTSPRITE21,((22*8)-4,5*8),15,13
3110ifo2thenPUTSPRITE22,((22*8)-4,7*8),6,14elsePUTSPRITE22,((22*8)-4,7*8),15,14
3120ifo3thenPUTSPRITE23,((22*8)-4,9*8),6,15elsePUTSPRITE23,((22*8)-4,9*8),15,15
3130ifo4thenPUTSPRITE24,((22*8)-4,11*8),6,16elsePUTSPRITE24,((22*8)-4,11*8),15,16
3140ifo5thenPUTSPRITE25,((22*8)-4,13*8),6,17elsePUTSPRITE25,((22*8)-4,13*8),15,17
3150ifo6thenPUTSPRITE26,((22*8)-4,15*8),6,18elsePUTSPRITE26,((22*8)-4,15*8),15,18
3190return
3200line(25*8,15*8)-(31*8,17*9),14,bf
3210tu=time/50
3220ta=(tm+tf)-tu
3230preset(24*8,15*8):print#1,ta
3290return
3300preset(0,23*8):print#1,en"ex0"ex(1)"ey0"ey(1)"ex1"ex(2)"ey1"ey(2)
3390return
4000a=usr2(0)
4010ifre=1thenPLAY"O5L8V4M8000AADFG2AAAAr60GEFDCDGR8A2A2A8","o1v4cr8o2cr8o1v6cr8o2v4cr8o1cr8o2v6cr8"
4020ifre=2thenPLAY"O5L8V4M8000AADFG2AAAAr60GEFDCDGR8A2A2A8"
4030ifre=5thenplay"l10o4v4gc"
4040ifre=6thenplay"t250o5v12dv9e"
4050ifre=7thenplay"O5L8V4M8000AADFG2AAAA"
4060ifre=8thenPLAY"S1M2000T150O7C32"
4070ifre=9thenPLAY"o2l64t255v4m6500c"
4060ifre=10thensound1,2:sound6,25:sound8,16:sound12,1:sound13,9
4070ifre=11thensound1,0:sound6,25:sound8,16:sound12,4:sound13,9
4090return
5000x=0:y=0:xp=0:yp=0:pw=8:ph=8:pv=8:pe=3:pc=0
5010p0=0:p1=1:p2=2:p3=3:p4=4:p5=5:p6=6:p7=7
5020return
5700pe=pe-1:pa=pa-pm:time=0
5720'gosub7000
5740gosub8300
5750gosub3000
5790return
6000em=5
6010DIMex(em),ey(em),ea(em),ei(em)
6020DIMev(em),el(em)
6030DIMew(em),eh(em),es(em),ec(em),ep(em)
6040DIMee(em)
6050en=0
6099return
6100en=en+1
6105ex(en)=0:ey(en)=0:ea(en)=0:ei(en)=0
6110ev(en)=8:el(en)=8
6130ew(en)=8:eh(en)=8:es(en)=8:ep(en)=10+en
6140ee(en)=100
6150et(en)=0
6160ec(en)=0
6190return
6600ifen<=0thenreturn
6610ex(ed)=ex(en):ey(ed)=ey(en):ev(ed)=ev(en):el(ed)=el(en):ec(ed)=ec(en):ee(ed)=ee(en):ep(ed)=ep(en):et(ed)=et(en)
6620putspriteep(ed),(0,212),,es(ed)
6630en=en-1
6640return
6700fori=0to10
6710PUTSPRITEi,(0,212),,0
6720nexti
6780en=0
6790return
7000os=0:oy=3*8
7020o1=1:o2=1:o3=1:o4=1:o5=1:o6=1
7090return
7100beep:os=os+1:ifos>6thenos=1
7105oy=oy+16:ifoy>15*8thenoy=5*8
7110line(0,21*8)-(247,24*8),15,bf
    7120 if os=1 and o1=1 then  preset (0,21*8):print #1,"Seleccion eliminada":preset (0,22*8)
    7130 if os=2 and o2=1 then  preset (0,21*8):print #1,"Seleccionada la espada: ":preset (0,22*8):print #1,"Puedes matar enemigos"
    7140 if os=3 and o3=1 then  preset (0,21*8):print #1,"Seleccionada el rayo:":preset (0,22*8):print #1,"Puedes romper los muros"
    7150 if os=4 and o4=1 then  preset (0,21*8):print #1,"Seleccionada la pala: ":preset (0,22*8):print #1,"Puedes pasar por debajo de los muros"             
    7160 if os=5 and o5=1 then  preset (0,21*8):print #1,"Seleccionada la escalera: ":preset (0,22*8):print #1,"Puedes pasar por encima de los muros"             
    7170 if os=6 and o6=1 then  preset (0,21*8):print #1,"Seleccionada la fuerza: " :preset (0,22*8):print #1,"Puedes mover los bloques amarillos"
7175PUTSPRITE20,((22*8)-4,oy),1,12
7190return
8000mw=0:ms=0:mc=0:tn=0
8020return
8300gosub6700
8310ifms=0thenx=5*8:y=10*8:gosub6100:ex(en)=15*8:ey(en)=1*8:et(en)=0:gosub6100:ex(en)=12*8:ey(en)=16*8:et(en)=1
8320ifms=1thenx=2*8:y=12*8:gosub6100:ex(en)=10*8:ey(en)=10*8:et(en)=0:gosub6100:ex(en)=7*8:ey(en)=4*8:et(en)=0
8330ifms=2thenx=7*8:y=9*8:gosub6100:ex(en)=10*8:ey(en)=1*8:et(en)=0:gosub6100:ex(en)=10*8:ey(en)=10*8:et(en)=1
8340ifms=3thenx=18*8:y=1*8:gosub6100:ex(en)=10*8:ey(en)=4*8:et(en)=0:gosub6100:ex(en)=10*8:ey(en)=13*8:et(en)=0
8350ifms=4thenx=2*8:y=12*8:gosub6100:ex(en)=1*8:ey(en)=11*8:et(en)=1:gosub6100:ex(en)=16*8:ey(en)=12*8:et(en)=0
8380'gosub3000
8390return
9000FORI=0TO18:SP$=""
9020FORJ=1TO8:READA$
9030SP$=SP$+CHR$(VAL("&H"+A$))
9040NEXTJ
9050SPRITE$(I)=SP$
9060NEXTI
9090DATA03,C3,D8,3C,BD,DB,E7,7E
9100DATAC0,C3,1B,3C,BD,DB,E7,7E
9110DATA76,E6,D8,BC,BC,D8,E3,73
9120DATA73,E3,D8,BC,BC,D8,E6,76
9130DATA7E,E7,DB,BD,3C,1B,C3,C0
9140DATA7E,E7,DB,BD,3C,D8,C3,03
9150DATACE,C7,1B,3D,3D,1B,67,6E
9160DATA6E,67,1B,3D,3D,1B,C7,CE
9170DATA18,3C,66,C3,C3,66,3C,18
9180DATA3C,7E,FF,E7,E7,FF,7E,3C
9190DATA81,C3,24,3C,3C,24,42,C3
9200DATA00,42,66,3C,3C,24,66,00
9210DATAFF,81,81,81,81,81,81,FF
9220DATA81,42,24,18,18,24,42,81
9230DATA01,02,04,88,50,20,D0,C8
9240DATA07,0E,38,70,0E,1C,70,E0
9250DATA0C,0C,0C,0C,0C,06,0F,0F
9260DATA24,24,3C,24,24,3C,24,24
9270DATA00,23,33,FB,FB,33,23,00
9990return
10000FORI=0TO(24*8)-1
10020READA$
10030VPOKEI,VAL("&H"+A$)
10040VPOKE2048+I,VAL("&H"+A$)
10050VPOKE4096+I,VAL("&H"+A$)
10060NEXTI
10100DATAFF,66,66,00,00,66,66,00
10101DATAFF,66,66,00,00,66,66,00
10102DATAFF,99,99,FF,FF,99,99,FF
10103DATAFF,FF,FF,FF,FF,FF,FF,FF
10104DATA7E,7E,7E,7E,7E,7E,7E,7E
10105DATA00,7E,7E,7E,7E,7E,7E,7E
10106DATA7E,7E,7E,7E,7E,7E,7E,00
10107DATA00,FF,FF,FF,FF,FF,FF,00
10108DATA00,FE,FE,FE,FE,FE,FE,00
10109DATA00,7F,7F,7F,7F,7F,7F,00
10110DATA7F,7F,7F,7F,7F,7F,7F,00
10111DATAFE,FE,FE,FE,FE,FE,FE,00
10112DATA00,FE,FE,FE,FE,FE,FE,FE
10113DATA00,7F,7F,7F,7F,7F,7F,7F
10114DATA00,F7,F7,F7,00,7F,7F,7F
10115DATA00,F7,F7,F7,00,7F,7F,7F
10116DATA00,F7,F7,F7,00,7F,7F,7F
10117DATA00,18,18,7E,7E,18,18,00
10118DATA00,7E,7E,7E,7E,7E,7E,7E
10119DATA5E,5E,7E,7E,7E,7E,7E,00
10120DATA18,3C,C3,81,1C,C3,3C,18
10121DATA00,7E,7E,7E,7E,7E,7E,7E
10122DATA5E,5E,7E,7E,7E,7E,7E,00
10123DATA18,3C,C3,81,1C,C3,3C,18
10500FORI=0TO(24*8)-1
10520READA$
10530VPOKE8192+I,VAL("&H"+A$):'&h2000'
10540VPOKE10240+I,VAL("&H"+A$):'&h2800'
10550VPOKE12288+I,VAL("&H"+A$):'&h3000'
10560NEXTI
10600DATAE1,FE,FE,FE,FE,FE,FE,FE
10601DATAA1,EA,EA,EA,EA,EA,EA,EA
10602DATAF1,FE,FE,FE,FE,FE,FE,FE
10603DATAA1,A1,A1,A1,A1,A1,A1,A1
10604DATAA1,A1,A1,A1,A1,A1,A1,A1
10605DATAA1,E1,A1,A1,A1,A1,A1,A1
10606DATAA1,A1,A1,A1,A1,A1,E1,E1
10607DATAE1,E1,A1,A1,A1,A1,E1,E1
10608DATAE1,E1,A1,A1,A1,A1,E1,E1
10609DATAE1,E1,A1,A1,A1,A1,E1,E1
10610DATAA1,A1,A1,A1,A1,A1,E1,E1
10611DATAA1,A1,A1,A1,A1,A1,E1,E1
10612DATAE1,E1,A1,A1,A1,A1,A1,A1
10613DATAA1,E1,A1,A1,A1,A1,A1,A1
10614DATAA1,81,81,81,81,81,81,81
10615DATA81,51,51,51,51,51,51,51
10616DATA51,31,31,31,31,31,31,31
10617DATA31,B1,B1,B1,B1,B1,B1,B1
10618DATAB1,91,71,71,71,71,91,91
10619DATA91,91,91,91,91,91,91,91
10620DATA7F,7F,75,75,85,75,7F,7F
10621DATA11,91,71,71,71,71,91,91
10622DATA91,91,91,91,91,91,91,91
10623DATA7F,7F,75,75,85,75,7F,7F
10690return
11000gosub6700
11010md=6144
11020forf=0to19
11030READmp$
11040forc=0to39step2
11050tn$=mid$(mp$,c+1,2)
11060tn=val("&h"+tn$)
11070VPOKEmd,tn:md=md+1
11160nextc
11170md=md+12
11180nextf
11190return
12000data000e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e00
12010data0e1404000000000000000000000000000000000e
12020data0e0004000d070707070c000000000d07070c000e
12030data0e0004000400000000040000000004120004000e
12040data0e0004000400000000030708000004130004000e
12050data0e000a070b00000000040000000004000004000e
12060data0e000000000000000004000907070b000004000e
12070data0e0707070707070c00040000000000000004000e
12080data0e00000000000004000a070707070707070b000e
12090data0e0000000000000400000000000000000000000e
12100data0e00000000000004000d0707070707070708000e
12110data0e000d070800000400040000000000000000000e
12120data0e00040000000004000a070707070c000907070e
12130data0e0004000d07070b00000000000004000000000e
12140data0e000400041400000009070c000004000000000e
12150data0e0004000a07070c0000000400000a07070c000e
12160data0e0004000000000400000004000000000004000e
12170data0e000a07070707030707070b000000000004000e
12180data0e0000000000000000000000000000000004140e
12190data000e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e00
12200data000e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e00
12210data0e0000000000000000090708000000000000000e
12220data0e1409070707070c0000000000000d070708000e
12230data0e0708000000000907070707080004000004000e
12240data0e0000000000000000000000040004000004000e
12250data0e00000907070707070c0000060004000004000e
12260data0e0500040000000000040000001404000004000e
12270data0e04000400000000000400000d0706000004000e
12280data0e0400040005000500040000041200000004000e
12290data0e0400040004000400040000041300000004000e
12300data0e0400040004000400040000090707070706000e
12310data0e0400040004000400040000000000000400000e
12320data0e0400040004000400040009070708000400090e
12330data0e0400040004000400040004000000000400000e
12340data0e0400040006000400060707070707070708000e
12350data0e0600040000000400000000000000000000000e
12360data0e0000060205000907070707070707080000000e
12370data0e0000000004000000000000000000040000000e
12380data0e0000000009070707070707070814040000140e
12390data000e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e00
12400data0004040404040404040404040404040404040400
12410data0600000000000000000000000000000000000007
12420data0600010202020202010000000102020202010007
12430data0600030000000000000000000000000000030007
12440data0600030000000000000000000000000009030007
12450data0600010202020202020202020202020202010007
12460data0600030000000000000000000000000000030007
12470data0600030000000009010000000100000000000007
12480data0600010202020202010000000102020202020207
12490data0600000000000000030000000308000000000007
12500data0600000000000000030000000300000000000007
12510data0600010202020202010000000102020202010007
12520data0600030000000000010000000100000000030007
12530data0600030000000000000000000000000000030007
12540data0600020202020202020202020202020200020007
12550data0602010000000000000000000000000000030007
12560data0600000000000000010000010900000000030007
12570data0600010202020202010000010202020202010007
12580data0600000000000000000000000000000000000007
12590data0005050505050505050505050505050505050500
12600data0004040404040404040404040404040404040400
12610data0600000000000009030000000300000000000007
12620data0600020201020202010202020102020001020207
12630data0600000003000000030000000000000003000007
12640data0600000000000000000000000300000003000007
12650data0600020201020202010202020102020201020207
12660data0600000003000000030000000000000903000007
12670data0600000000000000030000000300000000000007
12680data0602020001020002010202000102020001020207
12690data0600000003000000030000000300000003000007
12700data0600000003000000030000000300000003000007
12710data0600020201020202010002020102020201020207
12720data0600000000000000030000000300000003000007
12730data0600000003000000000000000000000000000007
12740data0602020201020200010202020102020201020007
12750data0600000003000000030000000300000003000007
12760data0600000000000000030000000000000003000007
12770data0602020001020202010202020102020201000207
12780data0600000000000009030000000308000000000007
12790data0005050505050505050505050505050505050500
12800data0404040404040404040404040404040404040404
12810data0602000000020000000202090000000000000207
12820data0600020000030000000202000002030000020007
12830data0600000200030002000000000200000002000007
12840data0600000002030000020000020000030000000007
12850data0600020202020200020202020202020202020007
12860data0600020000030200000000000002030000020007
12870data0600000200030002000000000209030002000007
12880data0600000002030000020800020000030200000007
12890data0602020000030000000202000000030000020207
12900data0602020000000000000202000000030000020207
12910data0600000000030000020000020000030200000007
12920data0600000200030002000000000200030000000007
12930data0600020000030200000000000000000002020007
12940data0600020202020200020202020202020202020007
12950data0600000002030000020000020000030200000007
12960data0600000000000002000000000200000002000007
12970data0600020000030200000202000002030000020907
12980data0602000000000000000202000000030000000207
12990data0505050505050505050505050505050505050505
13000data11111111111111111111
13010data10100000000000000001
13020data10100111110011111101
13030data10100100010010000101
13040data10100100010010000101
13050data10100100010010000101
13060data10100100010011110101
13070data10111100010000000101
13080data10000000011111111101
13090data10000111000000000101
13100data10000101001111111111
13110data11111101001000100001
13120data10000001001000100001
13130data10111001001000000001
13140data10100000001011111001
13150data10100111111010001001
13160data10100000000010011001
13170data10111111111110000001
13180data10000000000000000001
13190data11111111111111111111
13200data11111111111111111111
13210data10100000000000000001
13220data10100111110011111101
13230data10100100010010000101
13240data10100100010010000101
13250data10100100010010000101
13260data10100100010011110101
13270data10111100010000000101
13280data10000000011111111101
13290data10000111000000000101
13300data10000101001111111111
13310data11111101001000100001
13320data10000001001000100001
13330data10111001001000000001
13340data10100000001011111001
13350data10100111111010001001
13360data10100000000010011001
13370data10111111111110000001
13380data10000000000000000001
13390data11111111111111111111
13400data11111111111111111111
13410data10100000000000000001
13420data10100111110011111101
13430data10100100010010000101
13440data10100100010010000101
13450data10100100010010000101
13460data10100100010011110101
13470data10111100010000000101
13480data10000000011111111101
13490data10000111000000000101
13500data10000101001111111111
13510data11111101001000100001
13520data10000001001000100001
13530data10111001001000000001
13540data10100000001011111001
13550data10100111111010001001
13560data10100000000010011001
13570data10111111111110000001
13580data10000000000000000001
13590data11111111111111111111
13600data11111111111111111111
13610data10100000000000000001
13620data10100111110011111101
13630data10100100010010000101
13640data10100100010010000101
13650data10100100010010000101
13660data10100100010011110101
13670data10111100010000000101
13680data10000000011111111101
13690data10000111000000000101
13700data10000101001111111111
13710data11111101001000100001
13720data10000001001000100001
13730data10111001001000000001
13740data10100000001011111001
13750data10100111111010001001
13760data10100000000010011001
13770data10111111111110000001
13780data10000000000000000001
13790data11111111111111111111
13800data11111111111111111111
13810data10100000000000000001
13820data10100111110011111101
13830data10100100010010000101
13840data10100100010010000101
13850data10100100010010000101
13860data10100100010011110101
13870data10111100010000000101
13880data10000000011111111101
13890data10000111000000000101
13900data10000101001111111111
13910data11111101001000100001
13920data10000001001000100001
13930data10111001001000000001
13940data10100000001011111001
13950data10100111111010001001
13960data10100000000010011001
13970data10111111111110000001
13980data10000000000000000001
13990data11111111111111111111
