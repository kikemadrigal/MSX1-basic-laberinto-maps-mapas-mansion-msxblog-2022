10rem******************************
20remProgram:MansionMadrigal
30remautor:MSXMurcia
40rem******************************
50 print "Ejecutando instrucciones"
60defusr=&h003B:a=usr(0):defusr1=&h003E:a=usr1(0):defusr2=&H90:a=usr2(0):defusr3=&h41:defusr4=&h44
80screen2,0,0
90color1,15,7:keyoff
100definta-z:open"grp:"as#1:gosub3000
110 print #1,"Cargando sprites"
130gosub9000
140 cls: preset (60,10):print #1,"Mansion Madrigal"
150 preset (60,20):print #1,"MSX Murcia 2022"
160 preset (0,50):print #1,"Debes de ingeniar como salir del laberinto antes de que se te acabe el tiempo"
170 preset (0,90):print #1,"Utiliza las herramientas que tienes a ut disposicion, pulsa espacio para elegir una"
180 preset (0,130):print #1,"Solo puedes utilizarlas una cez por mundo"
190gosub3100
200 preset (0,21*8):print #1,"Pulsa una tecla para continuar"
210ifinkey$=""thengoto180elsecls
220'a=usr3(0)
230 print "Cargando graficos"
240gosub10000
250gosub11000
260'a=usr4(0)
270gosub3000
280gosub7000
290gosub3100
300gosub5000
310gosub6000
320gosub8300
330tm=40:time=0:intervalon:oninterval=50gosub3200
340strig(0)on:onstriggosub7100
350'spriteon:onspritegosub5700
400ta=tm-time/50
410ifta<=0thentime=0:gosub5700
420gosub1000
430gosub1760
440gosub1400
480ifmcthenms=ms+1:gosub11000:gosub3000:gosub8300:mc=0
500goto400
1000ST=STICK(0)ORSTICK(1)ORSTICK(2)
1010xp=x:yp=y
1020onstgosub1110,1120,1130,1140,1150,1160,1170
1030ifx<=0thenx=xp
1040ify<=0theny=yp
1050ify+ph>192theny=yp
1060ifx+pw>252thenx=xp
1090RETURN
1110y=y-pv:pp=0:re=10:gosub4000:return
1120return
1130x=x+pv:pp=2:re=10:gosub4000:return
1140return
1150y=y+pv:pp=1:re=10:gosub4000:return
1160return
1170x=x-pv:pp=3:re=10:gosub4000:return
1400PUTSPRITE0,(x,y),15,pp
1410ifen=0thenreturn
1430fori=1toen
1440ec(i)=ec(i)+1:ifec(i)>1thenec(i)=0
1450ifet(i)=0thenifec(i)=0thenes(i)=5elsees(i)=6
1460ifet(i)=1thenifec(i)=0thenes(i)=7elsees(i)=8
1490PUTSPRITEep(i),(ex(i),ey(i)),,es(i)
1495nexti
1520return
1760hl=base(5)+(y/8)*32+(x/8):a=vpeek(hl)
1770ifa>0anda<8thenifos=2ando2=1thenvpokehl,0:o2=0:gosub3100:re=10:gosub3000elsex=xp:y=yp
1780'ifa=2thenx=8*16:y=8*18:beep
1790ifa=8thenre=2:gosub4000:mc=1
1800ifa=9thentm=tm+30:time=0:re=5:gosub4000:vpokehl,0
1810ifpc=1thenpc=0:spriteon
1900fori=1toen
1910ifet(i)=0thenex(i)=ex(i)+ev(i)
1920ifet(i)=1theney(i)=ey(i)+el(i)
1930hl=base(5)+(ey(i)/8)*32+(ex(i)/8):a=vpeek(hl)
1940ifa>0anda<8thenifet(i)=0thenev(i)=-ev(i):ex(i)=ea(i):ey(i)=ei(i)elseifet(i)=1thenel(i)=-el(i):ex(i)=ea(i):ey(i)=ei(i)
1950ea(i)=ex(i):ei(i)=ey(i)
1960ifx<ex(i)+ew(i)andx+pw>ex(i)andy<ey(i)+eh(i)andy+ph>ey(i)thenifos=1ando1=1thenre=3:gosub4000:o1=0:ed=i:gosub6600:gosub3100elsebeep:gosub5700
1970nexti
1990return
2000ifpe=0thengosub5000
2010spriteoff:pe=pe-1:gosub3000:beep:pc=1
2090return
3000line(21*8,0)-(23*8,20*8),14,bf
3010line(24*8,0)-(247,20*8),14,bf
3020preset(25*8,3*8):print#1,"World"
3030preset(26*8,5*8):print#1,mw
3040preset(25*8,7*8):print#1,"Level"
3050preset(26*8,9*8):print#1,ms
3060preset(25*8,11*8):print#1,"Live"
3070preset(26*8,13*8):print#1,pe
3080preset(24*8,17*8):print#1,fre(0)
3090return
3100ifo1thenPUTSPRITE11,((22*8)-4,5*8),6,10elsePUTSPRITE11,((22*8)-4,5*8),15,10
3120ifo2thenPUTSPRITE12,((22*8)-4,7*8),6,11elsePUTSPRITE12,((22*8)-4,7*8),15,11
3130ifo3thenPUTSPRITE13,((22*8)-4,9*8),6,12elsePUTSPRITE13,((22*8)-4,9*8),15,12
3140ifo4thenPUTSPRITE14,((22*8)-4,11*8),6,13elsePUTSPRITE14,((22*8)-4,11*8),15,13
3190return
3200line(25*8,15*8)-(30*8,15*9),14,bf
3230preset(24*8,15*8):print#1,ta
3290return
3300preset(0,23*8):print#1,en"ex0"ex(1)"ey0"ey(1)"ex1"ex(2)"ey1"ey(2)
3390return
4000a=usr2(0)
4010ifre=1thenPLAY"O5L8V4M8000AADFG2AAAAr60GEFDCDGR8A2A2A8","o1v4cr8o2cr8o1v6cr8o2v4cr8o1cr8o2v6cr8"
4020ifre=2thenPLAY"O5L8V4M8000AADFG2AAAAr60GEFDCDGR8A2A2A8"
4030ifre=5thenplay"l10o4v4gc"
4040ifre=6thenplay"t250o5v12dv9e"
4050ifre=7thenplay"O5L8V4M8000AADFG2AAAA"
4060ifre=8thenPLAY"S1M2000T150O7C32"
4070ifre=9thenPLAY"o2l64t255v4m6500c"
4060ifre=10thensound1,2:sound6,25:sound8,16:sound12,1:sound13,9
4070ifre=11thensound1,0:sound6,25:sound8,16:sound12,4:sound13,9
4090return
5000x=0:y=0:xp=0:yp=0:pw=8:ph=8:pv=8:pe=3:pc=0
5020return
5700pe=pe-1:pa=pa-pm:time=0
5710'ifpe<=0thenrestore12000:close:goto60
5720'gosub7000
5740gosub8300
5790return
6000em=5
6010DIMex(em),ey(em),ea(em),ei(em)
6020DIMev(em),el(em)
6030DIMew(em),eh(em),es(em),ec(em),ep(em)
6040DIMee(em)
6050en=0
6099return
6100en=en+1
6105ex(en)=0:ey(en)=0:ea(en)=0:ei(en)=0
6110ev(en)=8:el(en)=8
6130ew(en)=8:eh(en)=8:es(en)=5:ep(en)=4+en
6140ee(en)=100
6150et(en)=0
6160ec(en)=0
6190return
6600ifen<=0thenreturn
6610ex(ed)=ex(en):ey(ed)=ey(en):ev(ed)=ev(en):el(ed)=el(en):ec(ed)=ec(en):ee(ed)=ee(en):ep(ed)=ep(en):et(ed)=et(en)
6620putspriteep(ed),(0,212),,es(ed)
6630en=en-1
6640return
6700fori=0to10
6710PUTSPRITEi,(0,212),,0
6720nexti
6780en=0
6790return
7000os=0
7010ox=0:oy=24
7020o1=1:o2=1:o3=1:o4=1
7090return
7100beep:os=os+1:ifos>4thenos=1
7110line(0,21*8)-(247,24*8),15,bf
7120oy=oy+16:ifoy>88thenoy=5*8
    7130 if os=1 and o1=1 then  preset (0,21*8):print #1,"Seleccionada la espada: ":preset (0,22*8):print #1,"Puedes matar enemigos"
    7140 if os=2 and o2=1 then  preset (0,21*8):print #1,"Seleccionada el rayo:":preset (0,22*8):print #1,"Puedes romper los muros"
    7150 if os=3 and o3=1 then  preset (0,21*8):print #1,"Seleccionada la pala: ":preset (0,22*8):print #1,"Puedes dar palazos"             
    7160 if os=4 and o4=1 then  preset (0,21*8):print #1,"Seleccionada la fuerza: " :preset (0,22*8):print #1,"Puedes mover los bloques amarillos"
7170PUTSPRITE10,((22*8)-4,oy),1,9
7190return
8000mw=0:ms=0:mc=0:tn=0
8020return
8300gosub6700
8310ifms=0thenx=5*8:y=8*8:gosub6100:ex(en)=15*8:ey(en)=1*8:et(en)=0:gosub6100:ex(en)=12*8:ey(en)=16*8:et(en)=1
8320ifms=1thenx=2*8:y=12*8:gosub6100:ex(en)=10*8:ey(en)=10*8:et(en)=0:gosub6100:ex(en)=7*8:ey(en)=4*8:et(en)=0
8330ifms=2thenx=7*8:y=9*8:gosub6100:ex(en)=10*8:ey(en)=1*8:et(en)=0:gosub6100:ex(en)=10*8:ey(en)=10*8:et(en)=1
8340ifms=3thenx=18*8:y=1*8:gosub6100:ex(en)=10*8:ey(en)=4*8:et(en)=0:gosub6100:ex(en)=10*8:ey(en)=13*8:et(en)=0
8350ifms=4thenx=2*8:y=12*8:gosub6100:ex(en)=1*8:ey(en)=11*8:et(en)=1:gosub6100:ex(en)=16*8:ey(en)=12*8:et(en)=0
8380gosub3000
8390return
9000FORI=0TO13:SP$=""
9020FORJ=1TO8:READA$
9030SP$=SP$+CHR$(VAL("&H"+A$))
9040NEXTJ
9050SPRITE$(I)=SP$
9060NEXTI
9070DATA18,18,66,5A,5A,24,24,66
9080DATA18,18,24,3C,3C,18,18,3C
9090DATA18,18,10,18,1C,18,18,1C
9100DATA18,18,08,18,38,18,18,38
9110DATAE3,E3,E3,3E,3E,3E,F9,F9
9120DATA18,3C,66,42,C3,C3,C3,FF
9130DATA00,00,00,3C,42,FF,FF,FF
9140DATA81,DB,3C,18,18,66,42,C3
9150DATA00,18,7E,5A,18,24,24,66
9160DATAFF,81,81,81,81,81,81,FF
9170DATA01,02,04,88,50,20,D0,C8
9180DATA07,0E,38,70,0E,1C,70,E0
9190DATA0C,0C,0C,0C,0C,06,0F,0F
9200DATA00,23,33,FB,FB,33,23,00
9990return
10000FORI=0TO(10*8)-1
10020READA$
10030VPOKEI,VAL("&H"+A$)
10040VPOKE2048+I,VAL("&H"+A$)
10050VPOKE4096+I,VAL("&H"+A$)
10060NEXTI
10070DATA00,00,00,00,00,00,00,00
10080DATAFF,FF,FF,FF,FF,FF,FF,FF
10090DATAFF,FF,FF,00,00,FF,FF,FF
10100DATAE7,E7,E7,E7,E7,E7,E7,E7
10110DATA00,F7,F7,F7,00,7F,7F,7F
10120DATAFB,FB,FB,00,BF,BF,BF,00
10130DATA77,07,77,77,77,70,77,77
10140DATAEE,EE,0E,EE,EE,EE,E0,EE
10150DATA18,3C,7E,7E,24,7E,7E,7E
10160DATA18,3C,7E,81,1C,7E,3C,18
10500FORI=0TO(10*8)-1
10520READA$
10530VPOKE8192+I,VAL("&H"+A$):'&h2000'
10540VPOKE10240+I,VAL("&H"+A$):'&h2800'
10550VPOKE12288+I,VAL("&H"+A$):'&h3000'
10560NEXTI
10570DATA11,11,11,11,11,11,11,11
10580DATAA1,A1,A1,A1,A1,A1,A1,A1
10590DATAA1,A1,E1,E1,E1,E1,A1,A1
10600DATAA1,A1,A1,A1,A1,A1,A1,A1
10610DATAA1,81,81,81,81,81,81,81
10620DATA81,81,81,81,81,81,81,81
10630DATA81,81,81,81,81,81,81,81
10640DATA81,81,81,81,81,81,81,81
10650DATA41,41,41,91,79,91,91,91
10660DATA71,51,51,75,85,51,51,71
10690return
11000gosub6700
11010md=6144
11020forf=0to19
11030READD$
11040forc=0to19
11050tn$=mid$(D$,c+1,1)
11060tn=val(tn$)
11070VPOKEmd+c,tn
11160nextc
11170md=md+32
11180nextf
11190return
12000data04444444444444444440
12010data69300000000000000007
12020data60301222210001122107
12030data60303000030000380307
12040data60303000032200300307
12050data60121000030000300307
12060data60000000030222100307
12070data62222221030000000307
12080data60000003012222222107
12090data60000003000000000007
12100data60000003012222222207
12110data60122003030000000007
12120data60300003012222102227
12130data60301221000000300007
12140data60303900022100300007
12150data60301221000300122107
12160data60300003000300000307
12170data60122221222100000307
12180data60000000000000000397
12190data05555555555555555550
12200data04444444444444444440
12210data60000000022200000007
12220data69122221000000122107
12230data62100001222210000307
12240data60000000000030000307
12250data60012222210030000307
12260data63030000030032210307
12270data63030000030000930307
12280data63030121030012230307
12290data63030303030038000307
12300data63030303030012221107
12310data63030303030000003007
12320data63030303030122203037
12330data63030303030300003007
12340data63030303012222222107
12350data63030003000000000007
12360data60012101222222210307
12370data60000300000000030307
12380data61000000222222012197
12390data05555555555555555550
12400data44444444444444444444
12410data60000000000000000007
12420data60322222300032222307
12430data60300000000000000307
12440data60300000000000009307
12450data60222222222222222207
12460data60300000000000000307
12470data60300009300030000007
12480data60322222200022222327
12490data60000000300038000007
12500data60000000300030000007
12510data60322222200022222307
12520data60300000300030000307
12530data60300000000000000307
12540data60222222222222220207
12550data62300000000000000307
12560data60000000300390000307
12570data60322222200222222307
12580data60000000000000000007
12590data55555555555555555555
12600data04444444444444444440
12610data60000009300030000007
12620data60221222122212201227
12630data60003000300000003007
12640data60000000000030003007
12650data60221222122212221227
12660data60003000300000093007
12670data60000000300030000007
12680data62201202122012201227
12690data60003000300030003007
12700data60003000300030003007
12710data60221222102212221227
12720data60000000300030003007
12730data60003000000000000007
12740data62221220122212221207
12750data60003000300030003007
12760data60000000300000003007
12770data62201222122212221027
12780data60000009300038000007
12790data05555555555555555550
12800data44444444444444444444
12810data62000200022900000027
12820data60200300022002300207
12830data60020302000020002007
12840data60002300200200300007
12850data60222220222222222207
12860data60200320000002300207
12870data60020302000029302007
12880data60002300280200320007
12890data62200300022000300227
12900data62200000022000300227
12910data60000300200200320007
12920data60020302000020300007
12930data60200320000000002207
12940data60222220222222222207
12950data60002300200200320007
12960data60000002000020002007
12970data60200320022002300297
12980data62000000022000300027
12990data55555555555555555555
13000data11111111111111111111
13010data10100000000000000001
13020data10100111110011111101
13030data10100100010010000101
13040data10100100010010000101
13050data10100100010010000101
13060data10100100010011110101
13070data10111100010000000101
13080data10000000011111111101
13090data10000111000000000101
13100data10000101001111111111
13110data11111101001000100001
13120data10000001001000100001
13130data10111001001000000001
13140data10100000001011111001
13150data10100111111010001001
13160data10100000000010011001
13170data10111111111110000001
13180data10000000000000000001
13190data11111111111111111111
13200data11111111111111111111
13210data10100000000000000001
13220data10100111110011111101
13230data10100100010010000101
13240data10100100010010000101
13250data10100100010010000101
13260data10100100010011110101
13270data10111100010000000101
13280data10000000011111111101
13290data10000111000000000101
13300data10000101001111111111
13310data11111101001000100001
13320data10000001001000100001
13330data10111001001000000001
13340data10100000001011111001
13350data10100111111010001001
13360data10100000000010011001
13370data10111111111110000001
13380data10000000000000000001
13390data11111111111111111111
13400data11111111111111111111
13410data10100000000000000001
13420data10100111110011111101
13430data10100100010010000101
13440data10100100010010000101
13450data10100100010010000101
13460data10100100010011110101
13470data10111100010000000101
13480data10000000011111111101
13490data10000111000000000101
13500data10000101001111111111
13510data11111101001000100001
13520data10000001001000100001
13530data10111001001000000001
13540data10100000001011111001
13550data10100111111010001001
13560data10100000000010011001
13570data10111111111110000001
13580data10000000000000000001
13590data11111111111111111111
13600data11111111111111111111
13610data10100000000000000001
13620data10100111110011111101
13630data10100100010010000101
13640data10100100010010000101
13650data10100100010010000101
13660data10100100010011110101
13670data10111100010000000101
13680data10000000011111111101
13690data10000111000000000101
13700data10000101001111111111
13710data11111101001000100001
13720data10000001001000100001
13730data10111001001000000001
13740data10100000001011111001
13750data10100111111010001001
13760data10100000000010011001
13770data10111111111110000001
13780data10000000000000000001
13790data11111111111111111111
13800data11111111111111111111
13810data10100000000000000001
13820data10100111110011111101
13830data10100100010010000101
13840data10100100010010000101
13850data10100100010010000101
13860data10100100010011110101
13870data10111100010000000101
13880data10000000011111111101
13890data10000111000000000101
13900data10000101001111111111
13910data11111101001000100001
13920data10000001001000100001
13930data10111001001000000001
13940data10100000001011111001
13950data10100111111010001001
13960data10100000000010011001
13970data10111111111110000001
13980data10000000000000000001
13990data11111111111111111111
